{# src/OCBookingBundle/Ressources/views/Ticket/card.html.twig#}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}OC Plateforme{% endblock %}</title>

    {% block stylesheets %}

        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../../BookingBundle/Resources/public/css/Base.css">
        <link rel="stylesheet" href="{{ asset('bundles/ocbooking/css/Base.css') }}">

    {% endblock %}
</head>
<body>
    <div class="container">
        <h3>Carte client</h3>


            <div class="col-lg-4" id="card-container">
                <div class="well">
                <h3> Montant de la Transaction :</h3>  <h3></h3>
                 {{ form(card) }}
                    <a href="{{ path('oc_booking_homepage') }}" class="btn btn-default">Annulation - Retour à la Boutique</a>
                </div>
                <small>Votre transaction est sécurisé par Paiement CIC. Et effectué par le système de paiement Stripe (c). Votre paiement sera réalisé en toute sécurité</small>
        </div>
    </div>
</body>


<!-- Récupération information Carte -->

{% block javascripts %}


<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script>
    Stripe.setPublishableKey('pk_test_QWMtNMNsUVZ8j9SxvbVJjMjE');

    var $form = $('#payment-form'); // On récupère le formulaire
    $form.submit(function (e) {
        e.preventDefault();
        $form.find('button').prop('disabled', true); // On désactive le bouton submit
        Stripe.card.createToken({
            number: $('.card-number').val(),
            cvc: $('.card-cvc').val(),
            exp_month: $('.card-expiry-month').val(),
            exp_year: $('.card-expiry-year').val()
        }, function (status, response) {
            if (response.error) { // Ah une erreur !
                // On affiche les erreurs
                $form.find('.payment-errors').text(response.error.message);
                $form.find('button').prop('disabled', false); // On réactive le bouton
            } else { // Le token a bien été créé
                var token = response.id; // On récupère le token
                // On crée un champs cachée qui contiendra notre token
                $form.append($('<input type="hidden" name="stripeToken" />').val(token));
                $form.get(0).submit(); // On soumet le formulaire
            }
        });
    });
</script>
{% endblock %}